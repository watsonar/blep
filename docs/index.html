---
layout: splash
author_profile: true
---

<html>
    <head>
        <link href="https://unpkg.com/tabulator-tables@4.9.1/dist/css/tabulator.min.css" rel="stylesheet">
        <script type="text/javascript" src="https://unpkg.com/tabulator-tables@4.9.1/dist/js/tabulator.min.js"></script>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
        <style>
            /* Chrome, Safari, Edge, Opera */
            input::-webkit-outer-spin-button,
            input::-webkit-inner-spin-button {
              -webkit-appearance: none;
              margin: 0;
            }
            
            /* Firefox */
            input[type=number] {
              -moz-appearance: textfield;
            }
            #clear-filters {
              border-style: solid;
              border-width: 1px;
              color: black;
              background-color: white;
              padding: 4px;
              text-align: center;
              text-decoration: none;
              display: inline-block;
              font-size: 16px;
              margin: 2px;
              cursor: pointer;
            }
            #clear-filters:hover {
              border-style: solid;
              border-width: 1px;
              color: black;
              background-color: orange;
              padding: 4px;
              text-align: center;
              text-decoration: none;
              display: inline-block;
              font-size: 16px;
              margin: 2px;
              cursor: pointer;
            }
        </style>

    </head>
    <body>

        <button id="clear-filters">Clear filters.</button>
        <div id="example-table"></div>
        <script>
            //custom includes excludes keyword header filter
    		var inclExclFilterEditor = function(cell, onRendered, success, cancel, editorParams){
    		    var exclude;
    		    var container = document.createElement("span");
    		    //create and style inputs
    		    var include = document.createElement("input");
    		    include.setAttribute("type", "string");
    		    include.setAttribute("placeholder", "Includes any");
                include.setAttribute("min", 0);
                include.setAttribute("max", 100);
    		    include.style.padding = "4px";
    			include.style.margin = "2px";
    		    include.style.width = "45%";
    		    include.style.boxSizing = "border-box";
    		    include.value = cell.getValue();
    		    function buildValues(){
    		        success({
    		            include:include.value,
    		            exclude:exclude.value,
    		        });
    		    }
    		    exclude = include.cloneNode();
    		    exclude.setAttribute("placeholder", "Excludes any");
    		    include.addEventListener("change", buildValues);
    		    include.addEventListener("focusout", buildValues);
    		    exclude.addEventListener("change", buildValues);
    		    exclude.addEventListener("blur", buildValues);
    		    container.appendChild(include);
    		    container.appendChild(exclude);
    		    return container;
    		}
            //custom includes excludes keyword filter function
            function keywordFilterInclExclAny(headerValue, rowValue, rowData, filterParams) {
			    let keywords_incl = headerValue.include.toLowerCase().split(" ").filter(function(word){
                    return word != "";});
			    let keywords_excl = headerValue.exclude.toLowerCase().split(" ").filter(function(word){
                    return word != "";});
			    let keywordsFound_incl = []
			    keywords_incl.forEach(keyword => {
			        if (rowValue != null) {
						keywordsFound_incl.push(rowValue.toLowerCase().includes(keyword))
			    	}
				});
			    let keywordsFound_excl = []
			    keywords_excl.forEach(keyword => {
			        if (rowValue != null) {
						keywordsFound_excl.push(rowValue.toLowerCase().includes(keyword))
			    	}
                });
                if (keywordsFound_excl.some(keyword_excl => keyword_excl)) {
                    return false;
                }else{
                    if (keywordsFound_incl.length == 0) {
                        return true;
                    }else{
                        if (keywordsFound_incl.some(keyword_incl => keyword_incl)) {
                            return true;
                        }else{
                            return false
                        }
                    }
                }
            }
            //custom max min header filter                                                          	
    		var minMaxFilterEditor = function(cell, onRendered, success, cancel, editorParams){
    		    var end;
    		    var container = document.createElement("span");
    		    //create and style inputs
    		    var start = document.createElement("input");
    		    start.setAttribute("type", "number");
    		    start.setAttribute("placeholder", "min");
                start.setAttribute("min", 0);
                start.setAttribute("max", 100);
    		    start.style.padding = "4px";
    			start.style.margin = "2px";
    		    start.style.width = "45%";
    		    start.style.boxSizing = "border-box";
    		    start.value = cell.getValue();
    		    function buildValues(){
    		        success({
    		            start:start.value,
    		            end:end.value,
    		        });
    		    }
    		    end = start.cloneNode();
    		    end.setAttribute("placeholder", "max");
    		    start.addEventListener("change", buildValues);
    		    start.addEventListener("focusout", buildValues);
    		    end.addEventListener("change", buildValues);
    		    end.addEventListener("blur", buildValues);
    		    container.appendChild(start);
    		    container.appendChild(end);
    		    return container;
    		 }
    		//custom max min filter function
    		function minMaxFilterFunction(headerValue, rowValue, rowData, filterParams){
    		    //headerValue - the value of the header filter element
    		    //rowValue - the value of the column in this row
    		    //rowData - the data for the row being filtered
    		    //filterParams - params object passed to the headerFilterFuncParams property
    		        if(rowValue){
    		            if(headerValue.start != ""){
    		                if(headerValue.end != ""){
    		                    return rowValue >= headerValue.start && rowValue <= headerValue.end;
    		                }else{
    		                    return rowValue >= headerValue.start;
    		                }
    		            }else{
    		                if(headerValue.end != ""){
    		                    return rowValue <= headerValue.end;
    		                }
    		            }
    		        }
    		
    		    return true; //must return a boolean, true if it passes the filter.
    		}

			//get data and build table
            $.getJSON("https://raw.githubusercontent.com/watsonar/willow/gh-pages/data/processed/processed_LITE_data_2020_11_25.json?token=AHUECOGFJVV4LAVMPBPM7BK7ZZ6LU")
            .done(function (food_data) {
				var table = new Tabulator("#example-table", {
                    height:600, // set height of table (in CSS or here), this enables the Virtual DOM and improves render speed dramatically (can be any valid css height value)
                 	layout:"fitColumns", //fit columns to width of table (optional)
                 	data:food_data,
                 	autoColumns:false,
                    columns:[
                        {title:"Product", field:"name", headerFilter:"input", headerFilter:inclExclFilterEditor, headerFilterFunc:keywordFilterInclExclAny},
                        {title:"URL", field:"url", formatter:"link"},
                        {title:"Price (USD)", field:"our_price", formatter:"money", formatterParams:{
                            symbol:"$", precision:2},
							headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction},
                        {title:"Price/kcal", field:"price_per_kcal", formatter:"money", formatterParams:{
                            symbol:"$", precision:6}, 
                            headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction},
                        {title:"Type", field:"food_form",  headerFilter:inclExclFilterEditor, headerFilterFunc:keywordFilterInclExclAny},
                        {title:"% Calories Protein (min)", field:"%_calories_min_protein", formatter:"money", formatterParams:{
                            symbol:"%", symbolAfter:true, precision:0},
							headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction},
                        {title:"% Calories Fat (min)", field:"%_calories_min_fat", formatter:"money", formatterParams:{
							symbol:"%", symbolAfter:true, precision:0}, 
							headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction},
                        {title:"% Calories Carbs", field:"%_calories_carbohydrate", formatter:"money", formatterParams:{
                            symbol:"%", symbolAfter:true, precision:0},
							headerFilter:minMaxFilterEditor, headerFilterFunc:minMaxFilterFunction},
                        {title:"Ingredients", field:"ingredients", headerFilter:inclExclFilterEditor, headerFilterFunc:keywordFilterInclExclAny},
                    ],
                    placeholder:"No Data Available :(", //display message to user on empty table
                })

                //table.setFilter("food_form", "keywords", "dehydrated");
            
                function clearHeaderFilters() {
                    table.clearHeaderFilter()}
                document.getElementById("clear-filters").addEventListener("click", clearHeaderFilters);
            });

        </script>
hiiiii

    </body>
</html>
